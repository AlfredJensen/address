(function(a){function c(a){this.text=a,this.parts=[]}function d(){}function e(a,c){var d;return c=(c||"").toUpperCase(),d=b[c]||b.EN,d(a)}var b={};c.prototype={_extractStreetParts:function(a){var b=a,c=[],d,e=this.parts,f=/^\d+$/,g=function(){return!0};while(b>=0&&g()){var h=isNaN(parseInt(e[b],10));c.length<2||h?c.unshift(e.splice(b--,1)):(d||(d=[]),d.unshift(e.splice(b--,1)),g=function(){var a=isNaN(parseInt(e[b],10));return d?!a:a})}this.number=d?d.join("/"):"",this.street=c.join(" ").replace(/\,/g,""),this.number=f.test(this.number)?parseInt(this.number,10):this.number},clean:function(a){a||a||[],this.text=this.text.toUpperCase();for(var b=0;b<a.length;b++)typeof a[b]=="function"?this.text=a[b].call(null,this.text):a[b]instanceof RegExp&&(this.text=this.text.replace(a[b],""));return this},extract:function(a,b){var c,d,e,f,g=[];if(typeof b=="object"&&typeof b.splice=="undefined"){var h=[];for(var i in b)h[h.length]=b[i],g[h.length-1]=i;b=h}for(d=0;d<b.length;d++)for(e=this.parts.length;e--;)c=b[d].exec(this.parts[e]),c&&(c[2]?this.parts.splice(e,1,c[2]):this.parts.splice(e,1),f=g[d]||c[1]);return this[a]=parseInt(f,10)||f,this},extractStreet:function(a){function d(d){var e=d;for(var f=d-1;f>=0;f--)for(var g=0;g<a.length;g++)if(a[g].test(c[f])&&c[f-1]&&!b.test(c[f-1])){e=f;break}return e}var b=/^(\d*|\d*\w)$/,c=this.parts;a=a||[];for(var e=c.length;e--;)for(var f=0;f<a.length;f++)if(a[f].test(c[e])&&e>0){this._extractStreetParts(d(e));break}return this},finalize:function(){return this.regions=this.parts.join(" ").split(/\,\s?/),this.parts=[],this},split:function(a){var b=this.text.split(a||" ");this.parts=[];for(var c=0;c<b.length;c++)b[c]&&(this.parts[this.parts.length]=b[c]);return this},toString:function(){var a="";return this.building&&(a+=this.building+"\n"),this.street&&(a+=this.number?this.number+" ":"",a+=this.street+"\n"),a+=this.regions.join(", ")+"\n",a}},d.prototype.accept=function(a){return new c(a)},d.prototype.compile=function(a){var b=[],c=/^\^?(.*)\,?\$?$/;for(var d=a.length;d--;)b[d]=new RegExp(a[d].replace(c,"^$1,?$"));return b},e.locales=b,function(a){var b=new d,c=b.compile(["ST(REET)?","(RD|ROAD)","(CT|COURT)","AV(ENUE)?","PL(ACE)?","(LN|LANE)","DR(IVE)?","(WY|WAY)"]);a.EN=function(a){return b.accept(a).clean([function(a){return a.replace(/(\w{2})\./g,"$1")},function(a){return a.replace(/^\s*SHOP\s?(\d*)\,?\s*/,"$1/")}]).split(/\s/).extract("unit",[/^(?:\#|APT|APARTMENT)\s?(\d+)/,/^(\d+)\/(.*)/]).extract("country",{AU:/^AUSTRAL/,US:/(^UNITED\sSTATES|^U\.?S\.?A?$)/}).extractStreet(c).finalize()}}(typeof e!="undefined"?e.locales:typeof module!="undefined"?module.exports:{}),typeof module!="undefined"&&module.exports?module.exports=e:typeof define!="undefined"?define("addressit",[],function(){return e}):a.addressit=e})(this)